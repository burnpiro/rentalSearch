(function () {
    angular.module('RentalSearchApp', [
        'ui.router', 'ngMaterial', 'ngMdIcons', 'rental-services'
    ])
    angular.module('RentalSearchApp')
        .config(function($httpProvider){
            $httpProvider.defaults.headers.common = ['X-Requested-With', 'Content-Type'];
        });
})();
(function () {
    angular.module('RentalSearchApp')
        .config(function ($stateProvider, $urlRouterProvider, $mdThemingProvider) {
            $urlRouterProvider.otherwise('/');
            $stateProvider
                .state('home', {
                    name: 'dashboard',
                    url: '/',
                    controller: 'DashboardController',
                    templateUrl: 'views/dashboard/dashboardView.html'
                })
                .state('settings', {
                    name: 'settings',
                    url: '/settings',
                    controller: 'SettingsController',
                    templateUrl: 'views/settings/settingsView.html'
                });
            $mdThemingProvider.theme('altTheme')
                .primaryPalette('green')
                .accentPalette('light-blue');
            $mdThemingProvider.setDefaultTheme('altTheme');
        });
})();
(function () {
    angular.module('RentalSearchApp')

        .controller('DashboardController', ['$scope', '$rootScope',
            function($scope, $rootScope) {
                var self = this;
                self.list = {
                    higher: 0
                };
                self.seen = {
                    olx: false,
                    gumtree: false
                };
                self.items = [];
                $rootScope.selectedTab = 0;
                self.selection = 'default';

                chrome.runtime.sendMessage({get: 'list'}, function(response) {
                    self.items = response;
                    // needs to be called because after response is received view is already rendered and have empty array
                    $scope.$apply();
                });

                self.changeSeen = function(hashId, type) {
                    chrome.runtime.sendMessage({seen: hashId, set:'seen', type: type}, function() {
                        //no response needed
                    });
                };

                self.markAllAsSeen = function(type) {
                    chrome.runtime.sendMessage({set:'allSeen', type: type}, function() {
                        //no response needed
                    });
                    _.forEach(self.items, function(item) {
                        if(item.type === type) {
                            item.seen = true;
                        }
                    })
                };

                self.openLink = function(item) {
                    self.changeSeen(item.hashId, item.type);
                    window.open(item.link,'_blank');
                }
            }
        ]);
})();
(function () {
    angular.module('RentalSearchApp')

        .controller('SettingsController', ['$scope', 'LinkService',
            function($scope, LinkService) {
                var self = this;
                self.sizeTypes = [
                    {
                        value: null,
                        name: 'All'
                    },
                    {
                        value: 'one',
                        name: 'Kawalerka / 1 room'
                    },
                    {
                        value: 'two',
                        name: '2 rooms'
                    },
                    {
                        value: 'three',
                        name: '3 rooms'
                    },
                    {
                        value: 'four',
                        name: '4+ rooms '
                    }
                ];
                self.categories = [
                    {
                        value: 'mieszkania/wynajem',
                        name: 'Mieszkania wynajem'
                    },
                    {
                        value: 'stancje-pokoje',
                        name: 'Pokoje/Stancje'
                    },
                    {
                        value: 'mieszkania/sprzedaz',
                        name: 'Mieszkania sprzedaz'
                    },
                    {
                        value: 'dzialki',
                        name: 'Działki'
                    },
                    {
                        value: 'biura-lokale',
                        name: 'Lokale i biura'
                    },
                    {
                        value: 'garaze-parkingi',
                        name: 'Parkingi i garaże'
                    }
                ]

                self.settings = {
                    interval: 1,
                    olxLink: 'http://olx.pl/nieruchomosci/mieszkania/wynajem/',
                    gumtreeLink: 'http://www.gumtree.pl/s-mieszkania-i-domy-do-wynajecia/v1c9008p1',
                    advanced: false,
                    automaticallyMarkAsSeen: false,
                    sizeType: null,
                    location: {},
                    locationDisplay: '',
                    category: 'mieszkania/wynajem'
                };
                self.items = [];

                chrome.runtime.sendMessage({get: 'settings'}, function(response) {
                    self.settings = response;
                    if(angular.isDefined(self.settings.location)) {
                        self.settings.locationDisplay = self.settings.location.display;
                    }
                    if(response.advanced) {
                        self.settings.gumtreeLink = response.gumtreeLink;
                    }
                    if(!self.settings.category) {
                        self.settings.category = 'mieszkania/wynajem';
                    }

                    // needs to be called because after response is received view is already rendered and have empty array
                    $scope.$apply();
                });

                self.saveSettings = function() {
                    var requestData = _.clone(self.settings);
                    if(self.settings.advanced) {
                        requestData.gumtreeLink = self.settings.gumtreeLink;
                    }
                    chrome.runtime.sendMessage({settings: requestData, set:'settings'}, function() {
                    });
                };

                self.querySearch = function(query) {
                    return query ? LinkService.searchLocationByName(query) : [];
                };

            }
        ]);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJhcHAucm91dGUuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkQ29udHJvbGxlci5qcyIsInNldHRpbmdzL3NldHRpbmdzQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ1JlbnRhbFNlYXJjaEFwcCcsIFtcbiAgICAgICAgJ3VpLnJvdXRlcicsICduZ01hdGVyaWFsJywgJ25nTWRJY29ucycsICdyZW50YWwtc2VydmljZXMnXG4gICAgXSlcbiAgICBhbmd1bGFyLm1vZHVsZSgnUmVudGFsU2VhcmNoQXBwJylcbiAgICAgICAgLmNvbmZpZyhmdW5jdGlvbigkaHR0cFByb3ZpZGVyKXtcbiAgICAgICAgICAgICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5jb21tb24gPSBbJ1gtUmVxdWVzdGVkLVdpdGgnLCAnQ29udGVudC1UeXBlJ107XG4gICAgICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdSZW50YWxTZWFyY2hBcHAnKVxuICAgICAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCAkbWRUaGVtaW5nUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbiAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnZGFzaGJvYXJkJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEYXNoYm9hcmRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9kYXNoYm9hcmQvZGFzaGJvYXJkVmlldy5odG1sJ1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdzZXR0aW5ncycsIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3NldHRpbmdzJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3NldHRpbmdzJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1NldHRpbmdzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3Mvc2V0dGluZ3Mvc2V0dGluZ3NWaWV3Lmh0bWwnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2FsdFRoZW1lJylcbiAgICAgICAgICAgICAgICAucHJpbWFyeVBhbGV0dGUoJ2dyZWVuJylcbiAgICAgICAgICAgICAgICAuYWNjZW50UGFsZXR0ZSgnbGlnaHQtYmx1ZScpO1xuICAgICAgICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnNldERlZmF1bHRUaGVtZSgnYWx0VGhlbWUnKTtcbiAgICAgICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ1JlbnRhbFNlYXJjaEFwcCcpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoJ0Rhc2hib2FyZENvbnRyb2xsZXInLCBbJyRzY29wZScsICckcm9vdFNjb3BlJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSkge1xuICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSB7XG4gICAgICAgICAgICAgICAgICAgIGhpZ2hlcjogMFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgc2VsZi5zZWVuID0ge1xuICAgICAgICAgICAgICAgICAgICBvbHg6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBndW10cmVlOiBmYWxzZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgc2VsZi5pdGVtcyA9IFtdO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuc2VsZWN0ZWRUYWIgPSAwO1xuICAgICAgICAgICAgICAgIHNlbGYuc2VsZWN0aW9uID0gJ2RlZmF1bHQnO1xuXG4gICAgICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe2dldDogJ2xpc3QnfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5pdGVtcyA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgICAgICAvLyBuZWVkcyB0byBiZSBjYWxsZWQgYmVjYXVzZSBhZnRlciByZXNwb25zZSBpcyByZWNlaXZlZCB2aWV3IGlzIGFscmVhZHkgcmVuZGVyZWQgYW5kIGhhdmUgZW1wdHkgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2VsZi5jaGFuZ2VTZWVuID0gZnVuY3Rpb24oaGFzaElkLCB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHtzZWVuOiBoYXNoSWQsIHNldDonc2VlbicsIHR5cGU6IHR5cGV9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gcmVzcG9uc2UgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBzZWxmLm1hcmtBbGxBc1NlZW4gPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHtzZXQ6J2FsbFNlZW4nLCB0eXBlOiB0eXBlfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL25vIHJlc3BvbnNlIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNlbGYuaXRlbXMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0udHlwZSA9PT0gdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2VlbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHNlbGYub3BlbkxpbmsgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhbmdlU2VlbihpdGVtLmhhc2hJZCwgaXRlbS50eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oaXRlbS5saW5rLCdfYmxhbmsnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdSZW50YWxTZWFyY2hBcHAnKVxuXG4gICAgICAgIC5jb250cm9sbGVyKCdTZXR0aW5nc0NvbnRyb2xsZXInLCBbJyRzY29wZScsICdMaW5rU2VydmljZScsXG4gICAgICAgICAgICBmdW5jdGlvbigkc2NvcGUsIExpbmtTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHNlbGYuc2l6ZVR5cGVzID0gW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdBbGwnXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnb25lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdLYXdhbGVya2EgLyAxIHJvb20nXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAndHdvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICcyIHJvb21zJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ3RocmVlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICczIHJvb21zJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ2ZvdXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJzQrIHJvb21zICdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgc2VsZi5jYXRlZ29yaWVzID0gW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ21pZXN6a2FuaWEvd3luYWplbScsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnTWllc3prYW5pYSB3eW5hamVtJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ3N0YW5jamUtcG9rb2plJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdQb2tvamUvU3RhbmNqZSdcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdtaWVzemthbmlhL3NwcnplZGF6JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdNaWVzemthbmlhIHNwcnplZGF6J1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ2R6aWFsa2knLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0R6aWHFgmtpJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ2JpdXJhLWxva2FsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnTG9rYWxlIGkgYml1cmEnXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnZ2FyYXplLXBhcmtpbmdpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdQYXJraW5naSBpIGdhcmHFvGUnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG5cbiAgICAgICAgICAgICAgICBzZWxmLnNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogMSxcbiAgICAgICAgICAgICAgICAgICAgb2x4TGluazogJ2h0dHA6Ly9vbHgucGwvbmllcnVjaG9tb3NjaS9taWVzemthbmlhL3d5bmFqZW0vJyxcbiAgICAgICAgICAgICAgICAgICAgZ3VtdHJlZUxpbms6ICdodHRwOi8vd3d3Lmd1bXRyZWUucGwvcy1taWVzemthbmlhLWktZG9teS1kby13eW5hamVjaWEvdjFjOTAwOHAxJyxcbiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5TWFya0FzU2VlbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNpemVUeXBlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjoge30sXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uRGlzcGxheTogJycsXG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiAnbWllc3prYW5pYS93eW5hamVtJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgc2VsZi5pdGVtcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe2dldDogJ3NldHRpbmdzJ30sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dGluZ3MgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQoc2VsZi5zZXR0aW5ncy5sb2NhdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dGluZ3MubG9jYXRpb25EaXNwbGF5ID0gc2VsZi5zZXR0aW5ncy5sb2NhdGlvbi5kaXNwbGF5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmFkdmFuY2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldHRpbmdzLmd1bXRyZWVMaW5rID0gcmVzcG9uc2UuZ3VtdHJlZUxpbms7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoIXNlbGYuc2V0dGluZ3MuY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0dGluZ3MuY2F0ZWdvcnkgPSAnbWllc3prYW5pYS93eW5hamVtJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIG5lZWRzIHRvIGJlIGNhbGxlZCBiZWNhdXNlIGFmdGVyIHJlc3BvbnNlIGlzIHJlY2VpdmVkIHZpZXcgaXMgYWxyZWFkeSByZW5kZXJlZCBhbmQgaGF2ZSBlbXB0eSBhcnJheVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzZWxmLnNhdmVTZXR0aW5ncyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdERhdGEgPSBfLmNsb25lKHNlbGYuc2V0dGluZ3MpO1xuICAgICAgICAgICAgICAgICAgICBpZihzZWxmLnNldHRpbmdzLmFkdmFuY2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YS5ndW10cmVlTGluayA9IHNlbGYuc2V0dGluZ3MuZ3VtdHJlZUxpbms7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe3NldHRpbmdzOiByZXF1ZXN0RGF0YSwgc2V0OidzZXR0aW5ncyd9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHNlbGYucXVlcnlTZWFyY2ggPSBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnkgPyBMaW5rU2VydmljZS5zZWFyY2hMb2NhdGlvbkJ5TmFtZShxdWVyeSkgOiBbXTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIF0pO1xufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=