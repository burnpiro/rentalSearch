(function () {
    angular.module('RentalSearchApp', [
        'ui.router', 'ngMaterial', 'ngMdIcons', 'rental-services'
    ])
    angular.module('RentalSearchApp')
        .config(function($httpProvider){
            $httpProvider.defaults.headers.common = ['X-Requested-With', 'Content-Type'];
        });
})();
(function () {
    angular.module('RentalSearchApp')
        .config(function ($stateProvider, $urlRouterProvider, $mdThemingProvider) {
            $urlRouterProvider.otherwise('/');
            $stateProvider
                .state('home', {
                    name: 'dashboard',
                    url: '/',
                    controller: 'DashboardController',
                    templateUrl: 'views/dashboard/dashboardView.html'
                })
                .state('settings', {
                    name: 'settings',
                    url: '/settings',
                    controller: 'SettingsController',
                    templateUrl: 'views/settings/settingsView.html'
                });
            $mdThemingProvider.theme('altTheme')
                .primaryPalette('green')
                .accentPalette('light-blue');
            $mdThemingProvider.setDefaultTheme('altTheme');
        });
})();
(function () {
  angular.module('RentalSearchApp')

    .controller('DashboardController', ['$scope', '$rootScope',
      function ($scope, $rootScope) {
        var self = this
        self.list = {
          higher: 0
        }
        self.seen = {
          olx: false,
          gumtree: false
        }
        self.items = []
        $rootScope.selectedTab = 0
        self.selection = 'default'

        chrome.runtime.sendMessage({get: 'list'}, function (response) {
          self.items = response
          // needs to be called because after response is received view is already rendered and have empty array
          $scope.$apply()
        })

        self.changeSeen = function (hashId, type) {
          chrome.runtime.sendMessage({seen: hashId, set: 'seen', type: type}, function () {
            //no response needed
          })
        }

        self.markAllAsSeen = function (type) {
          chrome.runtime.sendMessage({set: 'allSeen', type: type}, function () {
            //no response needed
          })
          _.forEach(self.items, function (item) {
            if (item.type === type) {
              item.seen = true
            }
          })
        }

        self.openLink = function (item) {
          self.changeSeen(item.hashId, item.type)
          window.open(item.link, '_blank')
        }
      }
    ])
})()
(function () {
  angular.module('RentalSearchApp')

    .controller('SettingsController', ['$scope', 'LinkService',
      function ($scope, LinkService) {
        var self = this
        self.sizeTypes = [
          {
            value: null,
            name: 'All'
          },
          {
            value: 'one',
            name: 'Kawalerka / 1 room'
          },
          {
            value: 'two',
            name: '2 rooms'
          },
          {
            value: 'three',
            name: '3 rooms'
          },
          {
            value: 'four',
            name: '4+ rooms '
          }
        ]
        self.categories = [
          {
            value: 'mieszkania/wynajem',
            name: 'Mieszkania wynajem'
          },
          {
            value: 'stancje-pokoje',
            name: 'Pokoje/Stancje'
          },
          {
            value: 'mieszkania/sprzedaz',
            name: 'Mieszkania sprzedaz'
          },
          {
            value: 'dzialki',
            name: 'Działki'
          },
          {
            value: 'biura-lokale',
            name: 'Lokale i biura'
          },
          {
            value: 'garaze-parkingi',
            name: 'Parkingi i garaże'
          }
        ]

        self.settings = {
          interval: 1,
          olxLink: [
            'http://olx.pl/nieruchomosci/mieszkania/wynajem/'
          ],
          gumtreeLink: [
            'http://www.gumtree.pl/s-mieszkania-i-domy-do-wynajecia/v1c9008p1'
          ],
          advanced: false,
          automaticallyMarkAsSeen: false,
          sizeType: null,
          location: {},
          locationDisplay: '',
          category: 'mieszkania/wynajem'
        }
        self.items = []

        chrome.runtime.sendMessage({get: 'settings'}, function (response) {
          self.settings = response
          if (angular.isDefined(self.settings.location)) {
            self.settings.locationDisplay = self.settings.location.display
          }
          if (response.advanced) {
            self.settings.gumtreeLink = response.gumtreeLink
          }
          if (!self.settings.category) {
            self.settings.category = 'mieszkania/wynajem'
          }
          if (typeof self.settings.olxLink === 'string') {
            self.settings.olxLink = [
              self.settings.olxLink
            ]
          }
          if (typeof self.settings.gumtreeLink === 'string') {
            self.settings.gumtreeLink = [
              self.settings.gumtreeLink
            ]
          }

          if (!self.settings.olxLink) {
            self.settings.olxLink = [
              ''
            ]
          }
          if (!self.settings.gumtreeLink) {
            self.settings.gumtreeLink = [
              ''
            ]
          }

          // needs to be called because after response is received view is already rendered and have empty array
          $scope.$apply()
        })

        self.saveSettings = function () {
          var requestData = _.clone(self.settings)
          if (self.settings.advanced) {
            requestData.gumtreeLink = self.settings.gumtreeLink
          }
          chrome.runtime.sendMessage({settings: requestData, set: 'settings'}, function () {
          })
        }

        self.addOlxLink = function () {
          self.settings.olxLink.push('')
        }
        self.addGumtreeLink = function () {
          self.settings.gumtreeLink.push('')
        }

        self.removeOlxLink = function (linkIndex) {
          delete self.settings.olxLink.splice(linkIndex, 1)
        }
        self.removeGumtreeLink = function (linkIndex) {
          delete self.settings.gumtreeLink.splice(linkIndex, 1)
        }
        self.querySearch = function (query) {
          return query ? LinkService.searchLocationByName(query) : []
        }

      }
    ])
})()
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJhcHAucm91dGUuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkQ29udHJvbGxlci5qcyIsInNldHRpbmdzL3NldHRpbmdzQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdSZW50YWxTZWFyY2hBcHAnLCBbXG4gICAgICAgICd1aS5yb3V0ZXInLCAnbmdNYXRlcmlhbCcsICduZ01kSWNvbnMnLCAncmVudGFsLXNlcnZpY2VzJ1xuICAgIF0pXG4gICAgYW5ndWxhci5tb2R1bGUoJ1JlbnRhbFNlYXJjaEFwcCcpXG4gICAgICAgIC5jb25maWcoZnVuY3Rpb24oJGh0dHBQcm92aWRlcil7XG4gICAgICAgICAgICAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uID0gWydYLVJlcXVlc3RlZC1XaXRoJywgJ0NvbnRlbnQtVHlwZSddO1xuICAgICAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnUmVudGFsU2VhcmNoQXBwJylcbiAgICAgICAgLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJG1kVGhlbWluZ1Byb3ZpZGVyKSB7XG4gICAgICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnaG9tZScsIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2Rhc2hib2FyZCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy8nLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGFzaGJvYXJkQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZGFzaGJvYXJkL2Rhc2hib2FyZFZpZXcuaHRtbCdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnc2V0dGluZ3MnLCB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdzZXR0aW5ncycsXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zZXR0aW5ncycsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTZXR0aW5nc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3NldHRpbmdzL3NldHRpbmdzVmlldy5odG1sJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdhbHRUaGVtZScpXG4gICAgICAgICAgICAgICAgLnByaW1hcnlQYWxldHRlKCdncmVlbicpXG4gICAgICAgICAgICAgICAgLmFjY2VudFBhbGV0dGUoJ2xpZ2h0LWJsdWUnKTtcbiAgICAgICAgICAgICRtZFRoZW1pbmdQcm92aWRlci5zZXREZWZhdWx0VGhlbWUoJ2FsdFRoZW1lJyk7XG4gICAgICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICBhbmd1bGFyLm1vZHVsZSgnUmVudGFsU2VhcmNoQXBwJylcblxuICAgIC5jb250cm9sbGVyKCdEYXNoYm9hcmRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHJvb3RTY29wZScsXG4gICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpc1xuICAgICAgICBzZWxmLmxpc3QgPSB7XG4gICAgICAgICAgaGlnaGVyOiAwXG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5zZWVuID0ge1xuICAgICAgICAgIG9seDogZmFsc2UsXG4gICAgICAgICAgZ3VtdHJlZTogZmFsc2VcbiAgICAgICAgfVxuICAgICAgICBzZWxmLml0ZW1zID0gW11cbiAgICAgICAgJHJvb3RTY29wZS5zZWxlY3RlZFRhYiA9IDBcbiAgICAgICAgc2VsZi5zZWxlY3Rpb24gPSAnZGVmYXVsdCdcblxuICAgICAgICBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7Z2V0OiAnbGlzdCd9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICBzZWxmLml0ZW1zID0gcmVzcG9uc2VcbiAgICAgICAgICAvLyBuZWVkcyB0byBiZSBjYWxsZWQgYmVjYXVzZSBhZnRlciByZXNwb25zZSBpcyByZWNlaXZlZCB2aWV3IGlzIGFscmVhZHkgcmVuZGVyZWQgYW5kIGhhdmUgZW1wdHkgYXJyYXlcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KClcbiAgICAgICAgfSlcblxuICAgICAgICBzZWxmLmNoYW5nZVNlZW4gPSBmdW5jdGlvbiAoaGFzaElkLCB0eXBlKSB7XG4gICAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe3NlZW46IGhhc2hJZCwgc2V0OiAnc2VlbicsIHR5cGU6IHR5cGV9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL25vIHJlc3BvbnNlIG5lZWRlZFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLm1hcmtBbGxBc1NlZW4gPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHtzZXQ6ICdhbGxTZWVuJywgdHlwZTogdHlwZX0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vbm8gcmVzcG9uc2UgbmVlZGVkXG4gICAgICAgICAgfSlcbiAgICAgICAgICBfLmZvckVhY2goc2VsZi5pdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgaXRlbS5zZWVuID0gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLm9wZW5MaW5rID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICBzZWxmLmNoYW5nZVNlZW4oaXRlbS5oYXNoSWQsIGl0ZW0udHlwZSlcbiAgICAgICAgICB3aW5kb3cub3BlbihpdGVtLmxpbmssICdfYmxhbmsnKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXSlcbn0pKCkiLCIoZnVuY3Rpb24gKCkge1xuICBhbmd1bGFyLm1vZHVsZSgnUmVudGFsU2VhcmNoQXBwJylcblxuICAgIC5jb250cm9sbGVyKCdTZXR0aW5nc0NvbnRyb2xsZXInLCBbJyRzY29wZScsICdMaW5rU2VydmljZScsXG4gICAgICBmdW5jdGlvbiAoJHNjb3BlLCBMaW5rU2VydmljZSkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXNcbiAgICAgICAgc2VsZi5zaXplVHlwZXMgPSBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAgICAgICBuYW1lOiAnQWxsJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6ICdvbmUnLFxuICAgICAgICAgICAgbmFtZTogJ0thd2FsZXJrYSAvIDEgcm9vbSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiAndHdvJyxcbiAgICAgICAgICAgIG5hbWU6ICcyIHJvb21zJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6ICd0aHJlZScsXG4gICAgICAgICAgICBuYW1lOiAnMyByb29tcydcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiAnZm91cicsXG4gICAgICAgICAgICBuYW1lOiAnNCsgcm9vbXMgJ1xuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgICBzZWxmLmNhdGVnb3JpZXMgPSBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6ICdtaWVzemthbmlhL3d5bmFqZW0nLFxuICAgICAgICAgICAgbmFtZTogJ01pZXN6a2FuaWEgd3luYWplbSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiAnc3RhbmNqZS1wb2tvamUnLFxuICAgICAgICAgICAgbmFtZTogJ1Bva29qZS9TdGFuY2plJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6ICdtaWVzemthbmlhL3NwcnplZGF6JyxcbiAgICAgICAgICAgIG5hbWU6ICdNaWVzemthbmlhIHNwcnplZGF6J1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6ICdkemlhbGtpJyxcbiAgICAgICAgICAgIG5hbWU6ICdEemlhxYJraSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiAnYml1cmEtbG9rYWxlJyxcbiAgICAgICAgICAgIG5hbWU6ICdMb2thbGUgaSBiaXVyYSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiAnZ2FyYXplLXBhcmtpbmdpJyxcbiAgICAgICAgICAgIG5hbWU6ICdQYXJraW5naSBpIGdhcmHFvGUnXG4gICAgICAgICAgfVxuICAgICAgICBdXG5cbiAgICAgICAgc2VsZi5zZXR0aW5ncyA9IHtcbiAgICAgICAgICBpbnRlcnZhbDogMSxcbiAgICAgICAgICBvbHhMaW5rOiBbXG4gICAgICAgICAgICAnaHR0cDovL29seC5wbC9uaWVydWNob21vc2NpL21pZXN6a2FuaWEvd3luYWplbS8nXG4gICAgICAgICAgXSxcbiAgICAgICAgICBndW10cmVlTGluazogW1xuICAgICAgICAgICAgJ2h0dHA6Ly93d3cuZ3VtdHJlZS5wbC9zLW1pZXN6a2FuaWEtaS1kb215LWRvLXd5bmFqZWNpYS92MWM5MDA4cDEnXG4gICAgICAgICAgXSxcbiAgICAgICAgICBhZHZhbmNlZDogZmFsc2UsXG4gICAgICAgICAgYXV0b21hdGljYWxseU1hcmtBc1NlZW46IGZhbHNlLFxuICAgICAgICAgIHNpemVUeXBlOiBudWxsLFxuICAgICAgICAgIGxvY2F0aW9uOiB7fSxcbiAgICAgICAgICBsb2NhdGlvbkRpc3BsYXk6ICcnLFxuICAgICAgICAgIGNhdGVnb3J5OiAnbWllc3prYW5pYS93eW5hamVtJ1xuICAgICAgICB9XG4gICAgICAgIHNlbGYuaXRlbXMgPSBbXVxuXG4gICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHtnZXQ6ICdzZXR0aW5ncyd9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICBzZWxmLnNldHRpbmdzID0gcmVzcG9uc2VcbiAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoc2VsZi5zZXR0aW5ncy5sb2NhdGlvbikpIHtcbiAgICAgICAgICAgIHNlbGYuc2V0dGluZ3MubG9jYXRpb25EaXNwbGF5ID0gc2VsZi5zZXR0aW5ncy5sb2NhdGlvbi5kaXNwbGF5XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZXNwb25zZS5hZHZhbmNlZCkge1xuICAgICAgICAgICAgc2VsZi5zZXR0aW5ncy5ndW10cmVlTGluayA9IHJlc3BvbnNlLmd1bXRyZWVMaW5rXG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghc2VsZi5zZXR0aW5ncy5jYXRlZ29yeSkge1xuICAgICAgICAgICAgc2VsZi5zZXR0aW5ncy5jYXRlZ29yeSA9ICdtaWVzemthbmlhL3d5bmFqZW0nXG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZi5zZXR0aW5ncy5vbHhMaW5rID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgc2VsZi5zZXR0aW5ncy5vbHhMaW5rID0gW1xuICAgICAgICAgICAgICBzZWxmLnNldHRpbmdzLm9seExpbmtcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLnNldHRpbmdzLmd1bXRyZWVMaW5rID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgc2VsZi5zZXR0aW5ncy5ndW10cmVlTGluayA9IFtcbiAgICAgICAgICAgICAgc2VsZi5zZXR0aW5ncy5ndW10cmVlTGlua1xuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghc2VsZi5zZXR0aW5ncy5vbHhMaW5rKSB7XG4gICAgICAgICAgICBzZWxmLnNldHRpbmdzLm9seExpbmsgPSBbXG4gICAgICAgICAgICAgICcnXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghc2VsZi5zZXR0aW5ncy5ndW10cmVlTGluaykge1xuICAgICAgICAgICAgc2VsZi5zZXR0aW5ncy5ndW10cmVlTGluayA9IFtcbiAgICAgICAgICAgICAgJydcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBuZWVkcyB0byBiZSBjYWxsZWQgYmVjYXVzZSBhZnRlciByZXNwb25zZSBpcyByZWNlaXZlZCB2aWV3IGlzIGFscmVhZHkgcmVuZGVyZWQgYW5kIGhhdmUgZW1wdHkgYXJyYXlcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KClcbiAgICAgICAgfSlcblxuICAgICAgICBzZWxmLnNhdmVTZXR0aW5ncyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgcmVxdWVzdERhdGEgPSBfLmNsb25lKHNlbGYuc2V0dGluZ3MpXG4gICAgICAgICAgaWYgKHNlbGYuc2V0dGluZ3MuYWR2YW5jZWQpIHtcbiAgICAgICAgICAgIHJlcXVlc3REYXRhLmd1bXRyZWVMaW5rID0gc2VsZi5zZXR0aW5ncy5ndW10cmVlTGlua1xuICAgICAgICAgIH1cbiAgICAgICAgICBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7c2V0dGluZ3M6IHJlcXVlc3REYXRhLCBzZXQ6ICdzZXR0aW5ncyd9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYuYWRkT2x4TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzZWxmLnNldHRpbmdzLm9seExpbmsucHVzaCgnJylcbiAgICAgICAgfVxuICAgICAgICBzZWxmLmFkZEd1bXRyZWVMaW5rID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNlbGYuc2V0dGluZ3MuZ3VtdHJlZUxpbmsucHVzaCgnJylcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYucmVtb3ZlT2x4TGluayA9IGZ1bmN0aW9uIChsaW5rSW5kZXgpIHtcbiAgICAgICAgICBkZWxldGUgc2VsZi5zZXR0aW5ncy5vbHhMaW5rLnNwbGljZShsaW5rSW5kZXgsIDEpXG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5yZW1vdmVHdW10cmVlTGluayA9IGZ1bmN0aW9uIChsaW5rSW5kZXgpIHtcbiAgICAgICAgICBkZWxldGUgc2VsZi5zZXR0aW5ncy5ndW10cmVlTGluay5zcGxpY2UobGlua0luZGV4LCAxKVxuICAgICAgICB9XG4gICAgICAgIHNlbGYucXVlcnlTZWFyY2ggPSBmdW5jdGlvbiAocXVlcnkpIHtcbiAgICAgICAgICByZXR1cm4gcXVlcnkgPyBMaW5rU2VydmljZS5zZWFyY2hMb2NhdGlvbkJ5TmFtZShxdWVyeSkgOiBbXVxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICBdKVxufSkoKSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==